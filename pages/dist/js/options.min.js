'use strict';var browser=browser,promises=!0;function domContentLoaded(){var i=[{label:'Default state',name:'default_state',type:'radio',options:[{label:'JS on',value:'on'},{label:'JS off',value:'off'}]},{label:'Disable behavior',name:'disable_behavior',type:'radio',options:[{label:'By domain',value:'domain'},{label:'By tab',value:'tab'}]},{label:'Enable shortcuts',details:'(<a href="about.html#shortcuts">More information</a>)',name:'shortcuts',type:'radio',options:[{label:'Yes',value:'true'},{label:'No',value:'false'}]},{label:'Enable context menu item',name:'context_menu',type:'radio',options:[{label:'Yes',value:'true'},{label:'No',value:'false'}]}],m='setting-',n=document.getElementById('add-domain-form-modal'),o=document.getElementById('add-domain-form'),l=document.getElementById('add-domain-form__domain-name'),e=document.getElementById('add-domain-form-modal__close'),s=document.getElementById('add-domain-form__include-sub-domains'),u=document.getElementById('remove'),v=document.getElementById('remove-all'),t=document.getElementById('add-domain'),b=document.getElementById('edit-domain'),d=document.getElementById('add-domain__previous_host'),r=document.getElementById('add-domain__title'),c=document.getElementById('add-domain__submit'),a=' <span class="version">(v'+browser.runtime.getManifest().version+')</span>';function g(e){var a=document.getElementById('domain-list--tbody'),t='',n=!1,o=[],l=document.getElementById('search');for(var s in e)s.startsWith(m)||(o.push(s),n=!0);for(var d=o.length-1;0<=d;d--){var r,i=!1;'string'==typeof e[s=o[d]]?r=new Date(e[s]):(r=new Date(e[s].date),i=e[s]['include-subdomains']),t+='<tr data-host="'+s+'" data-include-subdomains="'+(i?'true':'false')+'">',t+='<td>'+s+'</td>',t+='<td>'+r.toLocaleDateString()+' '+r.toLocaleTimeString()+'</td>',t+='<td>'+(i?'Yes':'No')+'</td>',t+='</tr>'}0===t.length?(t+='<tr>',t+='<td class="empty" colspan="3">You have not added any domains to your white-/blacklist yet.</td>',t+='</tr>',l.disabled=!0):l.disabled=!1,a.innerHTML=t;var c=a.querySelectorAll('tr');for(d=0;d<c.length;d++)c[d].addEventListener('click',function(){if(this.classList.contains('active'))this.classList.remove('active'),u.disabled=!0,b.disabled=!0;else{for(var e=a.querySelectorAll('tr.active'),t=0;t<e.length;t++)e[t].classList.remove('active');this.classList.add('active'),u.disabled=!1,b.disabled=!1}});n&&(v.disabled=!1)}function h(e){'domain'===e[m+'disable_behavior']?(document.body.classList.remove('disable-behavior--tab'),promises?browser.storage.local.get().then(g):browser.storage.local.get(g)):document.body.classList.add('disable-behavior--tab')}function f(){u.disabled=!0,v.disabled=!0,b.disabled=!0,promises?browser.storage.local.get(m+'disable_behavior').then(h):browser.storage.local.get(m+'disable_behavior',h)}function y(){var e=document.getElementsByClassName('active');if(o.reset(),'add-domain'===this.id)d.value='',r.innerHTML='Add a new host',c.value='Add host';else{var t=(e=e[0]).getAttribute('data-host'),a=e.getAttribute('data-include-subdomains');r.innerHTML='Edit host <em>'+t+'</em>',l.value=t,s.checked='true'===a,d.value=t,c.value='Edit host'}n.style.display='block',l.focus()}function p(){n.style.display='none'}function E(){var e={},t=this.value;switch(this.value){case'true':t=!0;break;case'false':t=!1}e[m+this.name]=t,browser.storage.local.set(e),browser.runtime.sendMessage({type:this.name,value:t}),f()}function w(e){for(var t='',a=0;a<i.length;a++){var n=i[a];t+='<tr>',t+='<td><label>'+n.label+'</label><span>','details'in n&&(t+=n.details),t+='</span></td><td>';for(var o=0;o<i[a].options.length;o++){var l=n.options[o],s=n.name+'-'+l.value,d='';e[m+n.name]===l.value?d=' checked="checked"':!0===e[m+n.name]&&'true'===l.value?d=' checked="checked"':!1===e[m+n.name]&&'false'===l.value&&(d=' checked="checked"'),t+='<input type="'+n.type+'" name="'+n.name+'" id="'+s+'" value="'+l.value+'"'+d+' />',t+='<label for="'+s+'">'+l.label+'</label>'}t+='</td>',t+='</tr>'}document.getElementById('settings').innerHTML=t;var r=document.querySelectorAll('input[type=radio]');for(a=0;a<r.length;a++)r[a].addEventListener('click',E)}for(var L=document.querySelectorAll('input[type=button]'),B=0;B<L.length;B++)switch(L[B].id){case'remove':case'remove-all':case'edit':L[B].disabled=!0}!function(){for(var e=[],t=0;t<i.length;t++)e.push(m+i[t].name);promises?browser.storage.local.get(e).then(w):browser.storage.local.get(e,w)}(),f(),u.addEventListener('click',function(){for(var e=document.querySelectorAll('#domain-list--tbody tr.active'),t=0;t<e.length;t++){var a=e[t].childNodes[0].innerHTML;promises?browser.storage.local.remove(a).then(f):browser.storage.local.remove(a,f)}}),v.addEventListener('click',function(){if(confirm('Are you sure to clear your domain list?')){for(var e={},t=0;t<i.length;t++){var a=i[t].name,n=document.querySelector('input[name="'+a+'"]:checked').value;e[m+a]=n}var o=browser.runtime.getManifest();e['setting-version']=o.version,promises?browser.storage.local.clear().then(function(){browser.storage.local.set(e).then(function(){f()})}):browser.storage.local.clear(function(){browser.storage.local.set(e,function(){f()})})}}),t.addEventListener('click',y),b.addEventListener('click',y),o.addEventListener('submit',function(e){e.preventDefault();var t=l.value;if(!function(e){return/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$/.test(e)}(t))return l.setCustomValidity('Please enter a valid host'),!1;d.value.length&&browser.storage.local.remove(d.value);var a={};return a[t]={date:(new Date).toISOString()},s.checked&&(a[t]['include-subdomains']=!0),promises?browser.storage.local.set(a).then(function(){f(),p()}):browser.storage.local.set(a,function(){f(),p()}),!1}),l.addEventListener('change',function(){this.setCustomValidity('')}),e.addEventListener('click',p),document.getElementById('search').value='',document.getElementById('search').addEventListener('keyup',function(){for(var e=document.getElementById('domain-list--tbody').getElementsByTagName('tr'),t=0;t<e.length;t++){var a=e[t].getElementsByTagName('td')[0];a&&(-1<a.innerHTML.toUpperCase().indexOf(this.value.toUpperCase())?e[t].style.display='':e[t].style.display='none')}}),window.addEventListener('click',function(e){void 0!==e&&e.target===n&&p()}),document.getElementById('page-title').innerHTML+=a}void 0===browser&&(browser=chrome,promises=!1),document.addEventListener('DOMContentLoaded',domContentLoaded);