'use strict';var browser=browser,promises=!0;function domContentLoaded(){var i=[{label:'Default state',name:'default_state',type:'radio',options:[{label:'JS on',value:'on'},{label:'JS off',value:'off'}]},{label:'Disable behavior',name:'disable_behavior',type:'radio',options:[{label:'By domain',value:'domain'},{label:'By tab',value:'tab'}]},{label:'Enable shortcuts',details:'(<a href="about.html#shortcuts">More information</a>)',name:'shortcuts',type:'radio',options:[{label:'Yes',value:'true'},{label:'No',value:'false'}]},{label:'Enable context menu item',name:'context_menu',type:'radio',options:[{label:'Yes',value:'true'},{label:'No',value:'false'}]}],m='setting-',o=document.getElementById('add-domain-form-modal'),n=document.getElementById('add-domain-form'),l=document.getElementById('add-domain-form__domain-name'),e=document.getElementById('add-domain-form-modal__close'),s=document.getElementById('add-domain-form__include-sub-domains'),v=document.getElementById('remove'),b=document.getElementById('remove-all'),t=document.getElementById('add-domain'),g=document.getElementById('edit-domain'),r=document.getElementById('add-domain__previous_host'),d=document.getElementById('add-domain__title'),c=document.getElementById('add-domain__submit'),a=' <span class="version">(v'+browser.runtime.getManifest().version+')</span>';function u(e){var a=document.getElementById('domain-list--tbody'),t='',o=!1,n=[],l=document.getElementById('search');for(var s in e)s.startsWith(m)||(n.push(s),o=!0);for(var r=n.length-1;0<=r;r--){var d,i,c=!1;'string'==typeof e[s=n[r]]?i=new Date(e[s]):(i=new Date(e[s].date),c=e[s]['include-subdomains'],d=e[s]['exception-type']),t+='<tr data-host="'+s+'" data-include-subdomains="'+(c?'true':'false')+'">',t+='<td>'+s+'</td>',t+='<td>'+i.toLocaleDateString()+' '+i.toLocaleTimeString()+'</td>',t+='<td>'+(c?'Yes':'No')+'</td>',t+='<td>'+d+'</td>',t+='</tr>'}0===t.length?(t+='<tr>',t+='<td class="empty" colspan="4">You have not added any domains to your white-/blacklist yet.</td>',t+='</tr>',l.disabled=!0):l.disabled=!1,a.innerHTML=t;var u=a.querySelectorAll('tr');for(r=0;r<u.length;r++)u[r].addEventListener('click',function(){if(this.classList.contains('active'))this.classList.remove('active'),v.disabled=!0,g.disabled=!0;else{for(var e=a.querySelectorAll('tr.active'),t=0;t<e.length;t++)e[t].classList.remove('active');this.classList.add('active'),v.disabled=!1,g.disabled=!1}});o&&(b.disabled=!1)}function h(e){'domain'===e[m+'disable_behavior']?(document.body.classList.remove('disable-behavior--tab'),promises?browser.storage.local.get().then(u):browser.storage.local.get(u)):document.body.classList.add('disable-behavior--tab')}function f(){v.disabled=!0,b.disabled=!0,g.disabled=!0,promises?browser.storage.local.get(m+'disable_behavior').then(h):browser.storage.local.get(m+'disable_behavior',h)}function y(){var e=document.getElementsByClassName('active');if(n.reset(),'add-domain'===this.id)r.value='',d.innerHTML='Add a new host',c.value='Add host';else{var t=(e=e[0]).getAttribute('data-host'),a=e.getAttribute('data-include-subdomains');d.innerHTML='Edit host <em>'+t+'</em>',l.value=t,s.checked='true'===a,r.value=t,c.value='Edit host'}o.style.display='block',l.focus()}function p(){o.style.display='none'}function E(){var e={},t=this.value;switch(this.value){case'true':t=!0;break;case'false':t=!1}e[m+this.name]=t,browser.storage.local.set(e),browser.runtime.sendMessage({type:this.name,value:t}),f()}function w(e){for(var t='',a=0;a<i.length;a++){var o=i[a];t+='<tr>',t+='<td><label>'+o.label+'</label><span>','details'in o&&(t+=o.details),t+='</span></td><td>';for(var n=0;n<i[a].options.length;n++){var l=o.options[n],s=o.name+'-'+l.value,r='';e[m+o.name]===l.value?r=' checked="checked"':!0===e[m+o.name]&&'true'===l.value?r=' checked="checked"':!1===e[m+o.name]&&'false'===l.value&&(r=' checked="checked"'),t+='<input type="'+o.type+'" name="'+o.name+'" id="'+s+'" value="'+l.value+'"'+r+' />',t+='<label for="'+s+'">'+l.label+'</label>'}t+='</td>',t+='</tr>'}document.getElementById('settings').innerHTML=t;var d=document.querySelectorAll('input[type=radio]');for(a=0;a<d.length;a++)d[a].addEventListener('click',E)}for(var L=document.querySelectorAll('input[type=button]'),B=0;B<L.length;B++)switch(L[B].id){case'remove':case'remove-all':case'edit':L[B].disabled=!0}!function(){for(var e=[],t=0;t<i.length;t++)e.push(m+i[t].name);promises?browser.storage.local.get(e).then(w):browser.storage.local.get(e,w)}(),f(),v.addEventListener('click',function(){for(var e=document.querySelectorAll('#domain-list--tbody tr.active'),t=0;t<e.length;t++){var a=e[t].childNodes[0].innerHTML;promises?browser.storage.local.remove(a).then(f):browser.storage.local.remove(a,f)}}),b.addEventListener('click',function(){if(confirm('Are you sure to clear your domain list?')){for(var e={},t=0;t<i.length;t++){var a=i[t].name,o=document.querySelector('input[name="'+a+'"]:checked').value;e[m+a]=o}var n=browser.runtime.getManifest();e['setting-version']=n.version,promises?browser.storage.local.clear().then(function(){browser.storage.local.set(e).then(function(){f()})}):browser.storage.local.clear(function(){browser.storage.local.set(e,function(){f()})})}}),t.addEventListener('click',y),g.addEventListener('click',y),n.addEventListener('submit',function(e){e.preventDefault();var t=l.value;if(!function(e){return/^(([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])$/.test(e)}(t))return l.setCustomValidity('Please enter a valid host'),!1;r.value.length&&browser.storage.local.remove(r.value);var a={};a[t]={date:(new Date).toISOString()},s.checked&&(a[t]['include-subdomains']=!0);var o=m+'default_state';function n(e){'off'==e[o]?a[t]['exception-type']='allow':a[t]['exception-type']='block'}return promises?(browser.storage.local.get(o).then(n),browser.storage.local.set(a).then(function(){f(),p()})):(browser.storage.local.get(o,n),browser.storage.local.set(a,function(){f(),p()})),!1}),l.addEventListener('change',function(){this.setCustomValidity('')}),e.addEventListener('click',p),document.getElementById('search').value='',document.getElementById('search').addEventListener('keyup',function(){for(var e=document.getElementById('domain-list--tbody').getElementsByTagName('tr'),t=0;t<e.length;t++){var a=e[t].getElementsByTagName('td')[0];a&&(-1<a.innerHTML.toUpperCase().indexOf(this.value.toUpperCase())?e[t].style.display='':e[t].style.display='none')}}),window.addEventListener('click',function(e){void 0!==e&&e.target===o&&p()}),document.getElementById('page-title').innerHTML+=a}void 0===browser&&(browser=chrome,promises=!1),document.addEventListener('DOMContentLoaded',domContentLoaded);